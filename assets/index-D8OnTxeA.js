(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();const F={CN:{three:"https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.min.js",mediapipe:{camera:"https://npm.elemecdn.com/@mediapipe/camera_utils/camera_utils.js",control:"https://npm.elemecdn.com/@mediapipe/control_utils/control_utils.js",drawing:"https://npm.elemecdn.com/@mediapipe/drawing_utils/drawing_utils.js",hands:"https://npm.elemecdn.com/@mediapipe/hands/hands.js",assets:"https://npm.elemecdn.com/@mediapipe/hands/"}},GLOBAL:{three:"https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js",mediapipe:{camera:"https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js",control:"https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js",drawing:"https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js",hands:"https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js",assets:"https://cdn.jsdelivr.net/npm/@mediapipe/hands/"}},LOCAL:{three:"libs/three/three.min.js",mediapipe:{camera:"libs/mediapipe/camera_utils.js",control:"libs/mediapipe/control_utils.js",drawing:"libs/mediapipe/drawing_utils.js",hands:"libs/mediapipe/hands.js",assets:"libs/mediapipe/"}}},l={colors:{darkGreen:875533,green:2263842,lightGreen:3329330,gold:16766720,warmWhite:16776656,red:16729156,blue:4491519,silver:12632256,starYellow:16776960},treeHeight:20,treeRadius:8,particleCount:5500,ornamentCount:18,lightCount:60,snowflakeCount:800},tt=["Merry Christmas!","Âú£ËØûÂø´‰πê!","Happy Holidays!","Êñ∞Âπ¥Âø´‰πê!","Peace & Joy"],P={IDLE:"IDLE",INTERACTIVE:"INTERACTIVE",CLOSED:"CLOSED"},s={current:P.IDLE,handVisible:!1,isHandOpen:!1,isPinching:!1,handX:.5,handY:.5,prevHandX:.5,prevHandY:.5,swipeDeltaX:0,swipeDeltaY:0,waveHistory:[],lastWaveTime:0,isWaving:!1,currentPhotoIndex:0,wasPinching:!1,targetSnowSpeed:1,targetCameraZ:35,targetCameraY:10,targetGroupRotation:0,mpAssetBase:"",photos:[]};async function S(a){return new Promise((e,i)=>{const o=document.createElement("script");o.src=a,o.crossOrigin="anonymous",o.onload=e,o.onerror=i,document.head.appendChild(o)})}async function rt(){const a=document.getElementById("loading");a.innerHTML="Ê≠£Âú®ËØªÂèñÈÖçÁΩÆ...";let e=F.LOCAL;try{const o=await fetch("config.json?t="+new Date().getTime());if(o.ok){const t=await o.json();console.log("Config loaded:",t),t.cdn_region==="CN"?e=F.CN:t.cdn_region==="GLOBAL"&&(e=F.GLOBAL)}else console.warn("Config load failed, using LOCAL default.")}catch(o){console.warn("Config load error, using LOCAL default.",o)}let i="Local Cache";e===F.CN&&(i="China Mirror"),e===F.GLOBAL&&(i="Global CDN"),a.innerHTML=`Ê≠£Âú®Âä†ËΩΩÊ†∏ÂøÉÂ∫ì...<br><span style="font-size:12px;color:#aaa">Source: ${i}</span>`,s.mpAssetBase=e.mediapipe.assets;try{await Promise.all([S(e.three),S(e.mediapipe.camera),S(e.mediapipe.control),S(e.mediapipe.drawing),S(e.mediapipe.hands)]),console.log("All scripts loaded.")}catch(o){throw a.innerHTML="Ê†∏ÂøÉÂ∫ìÂä†ËΩΩÂ§±Ë¥•<br>ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•",console.error("Script load error:",o),o}}async function ct(){const a=document.getElementById("loading");a.innerHTML="Ê≠£Âú®Ê£ÄÊµãÂõæÁâáËµÑÊ∫ê...";let e=1;const i=100;for(;e<=i;){const o=`assets/${e}.jpg`;try{if((await fetch(o,{method:"HEAD"})).ok)s.photos.push(o),e++;else break}catch(t){console.log("ÂõæÁâáÊ£ÄÊµãÁªìÊùü:",t);break}}console.log(`Ê£ÄÊµãÂà∞ ${s.photos.length} Âº†ÁÖßÁâá`),s.photos.length===0&&(a.innerHTML="Êú™Ê£ÄÊµãÂà∞ assets/X.jpg ÂõæÁâá<br>ËØ∑Á°Æ‰øùÂõæÁâáÂëΩÂêç‰∏∫ 1.jpg, 2.jpg...")}let m,M,I,Y=[],W,A,U,H,C,Z,ot=[],L,q,G=1;function Q(){const a=document.createElement("canvas");a.width=32,a.height=32;const e=a.getContext("2d"),i=16,t=e.createRadialGradient(i,i,0,i,i,14);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(.5,"rgba(255,215,0,0.5)"),t.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=t,e.fillRect(0,0,32,32);const n=new THREE.Texture(a);return n.needsUpdate=!0,n}function st(){const a=document.createElement("canvas");a.width=64,a.height=64;const e=a.getContext("2d"),i=32,t=e.createRadialGradient(i,i,0,i,i,30);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(.2,"rgba(255,255,200,0.8)"),t.addColorStop(.5,"rgba(255,200,100,0.4)"),t.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=t,e.fillRect(0,0,64,64);const n=new THREE.Texture(a);return n.needsUpdate=!0,n}function lt(){const a=document.createElement("canvas");a.width=32,a.height=32;const e=a.getContext("2d"),i=16,t=e.createRadialGradient(i,i,0,i,i,14);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(.3,"rgba(230,240,255,0.8)"),t.addColorStop(.6,"rgba(200,220,255,0.4)"),t.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=t,e.fillRect(0,0,32,32);const n=new THREE.Texture(a);return n.needsUpdate=!0,n}function dt(){const a=new THREE.BufferGeometry,e=[],i=[],o=[],t=new THREE.Color;for(let c=0;c<l.particleCount;c++){const u=Math.pow(Math.random(),1.5),p=u*l.treeHeight,d=l.treeRadius*(1-u*.95),h=Math.sin(u*Math.PI*8)*.3+1,g=d*h*(.3+Math.random()*.7),E=Math.random()*Math.PI*2,y=Math.cos(E)*g,f=Math.sin(E)*g;if(e.push(y,p,f),Math.random()>.9){const b=[l.colors.gold,l.colors.warmWhite,l.colors.red,l.colors.blue];t.setHex(b[Math.floor(Math.random()*b.length)]),o.push(.5+Math.random()*.3)}else{const b=[l.colors.darkGreen,l.colors.green,l.colors.lightGreen],v=Math.floor(Math.random()*b.length);t.setHex(b[v]),o.push(.2+Math.random()*.15)}i.push(t.r,t.g,t.b)}a.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),a.setAttribute("color",new THREE.Float32BufferAttribute(i,3)),a.setAttribute("size",new THREE.Float32BufferAttribute(o,1));const n=new THREE.PointsMaterial({size:.35,vertexColors:!0,blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0,map:Q()});W=new THREE.Points(a,n);const r=new THREE.Group;r.add(W),m.add(r),m.userData.treeGroup=r}function ut(){const a=m.userData.treeGroup,e=new THREE.BufferGeometry,i=[],o=[],t=[],n=new THREE.Color,r=2e3;for(let p=0;p<r;p++){const d=Math.random()*6,h=-d*.8,E=.8+Math.pow(d/6,2)*4+Math.random()*.4,y=Math.random()*Math.PI*2,f=Math.cos(y)*E,x=Math.sin(y)*E;i.push(f,h,x),Math.random()>.85?(n.setHex(l.colors.gold),t.push(.4+Math.random()*.2)):(n.setHex(6045747),n.r*=.8+Math.random()*.4,n.g*=.8+Math.random()*.4,n.b*=.8+Math.random()*.4,t.push(.25+Math.random()*.15)),o.push(n.r,n.g,n.b)}e.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),e.setAttribute("color",new THREE.Float32BufferAttribute(o,3)),e.setAttribute("size",new THREE.Float32BufferAttribute(t,1));const c=new THREE.PointsMaterial({size:.3,vertexColors:!0,blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0,opacity:.8,map:Q()}),u=new THREE.Points(e,c);a.add(u)}function ht(){const a=m.userData.treeGroup,e=400,i=2,o=l.treeHeight+.5,t=new THREE.BufferGeometry,n=[],r=[],c=[],u=new THREE.Color;for(let d=0;d<e;d++){const h=Math.random()*Math.PI*2;let g=Math.random()*i;const E=5,y=.4,f=Math.PI*2/E,x=f/2,b=(h%f+f)%f;let v=Math.abs(b-x);v=v/x;const k=THREE.MathUtils.lerp(i*y,i,1-v);g=Math.random()*k;const _=Math.cos(h)*g,D=Math.sin(h)*g,at=(Math.random()-.5)*.8;n.push(_,o+D,at),Math.random()>.7?u.setHex(l.colors.gold):u.setHex(l.colors.starYellow),r.push(u.r,u.g,u.b),c.push(.5+Math.random()*.8)}t.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),t.setAttribute("color",new THREE.Float32BufferAttribute(r,3)),t.setAttribute("size",new THREE.Float32BufferAttribute(c,1)),t.userData.initialPositions=n.slice(),t.userData.initialSizes=c.slice();const p=new THREE.PointsMaterial({size:.5,vertexColors:!0,blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0,opacity:.9,map:Q()});A=new THREE.Points(t,p),a.add(A)}function pt(){const a=m.userData.treeGroup,e=new THREE.BufferGeometry,i=[],o=[],t=[],n=[],r=[l.colors.red,l.colors.gold,l.colors.blue,l.colors.silver],c=new THREE.Color;for(let p=0;p<l.ornamentCount;p++){const d=.1+Math.random()*.75,h=d*l.treeHeight,g=l.treeRadius*(1-d*.9)*.85,E=p/l.ornamentCount*Math.PI*2+Math.random()*.5,y=g*(.7+Math.random()*.3),f=Math.cos(E)*y,x=Math.sin(E)*y;i.push(f,h,x);const b=r[p%r.length];c.setHex(b),o.push(c.r,c.g,c.b),t.push(1.5+Math.random()*1),n.push(Math.random()*Math.PI*2)}e.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),e.setAttribute("color",new THREE.Float32BufferAttribute(o,3)),e.setAttribute("size",new THREE.Float32BufferAttribute(t,1)),e.setAttribute("phase",new THREE.Float32BufferAttribute(n,1)),e.userData.originalPositions=i.slice();const u=new THREE.PointsMaterial({size:1,vertexColors:!0,blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0,opacity:.9,map:st()});C=new THREE.Points(e,u),a.add(C)}function mt(){const a=m.userData.treeGroup,e=new THREE.BufferGeometry,i=[],o=[],t=[l.colors.red,l.colors.gold,l.colors.blue,l.colors.warmWhite,l.colors.lightGreen],n=new THREE.Color;for(let c=0;c<l.lightCount;c++){const u=c/l.lightCount,p=u*l.treeHeight*.9+1,d=u*Math.PI*6,h=l.treeRadius*(1-u*.85)*1.05,g=Math.cos(d)*h,E=Math.sin(d)*h;i.push(g,p,E),n.setHex(t[c%t.length]),o.push(n.r,n.g,n.b)}e.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),e.setAttribute("color",new THREE.Float32BufferAttribute(o,3));const r=new THREE.PointsMaterial({size:.6,vertexColors:!0,blending:THREE.AdditiveBlending,transparent:!0,map:st()});Z=new THREE.Points(e,r),a.add(Z)}function gt(){const a=m.userData.treeGroup,e=[{box:13369344,ribbon:16766720},{box:26316,ribbon:16777215},{box:2263842,ribbon:16729156},{box:10040012,ribbon:16766720},{box:16766720,ribbon:13369344}];for(let i=0;i<5;i++){const o=i/5*Math.PI*2+.3,t=4+Math.random()*2,n=.8+Math.random()*.6,r=Math.cos(o)*t,c=Math.sin(o)*t,u=new THREE.BoxGeometry(n,n*.8,n),p=new THREE.MeshBasicMaterial({color:e[i].box,transparent:!0,opacity:.9}),d=new THREE.Mesh(u,p);d.position.set(r,-2.6+n*.4,c),d.rotation.y=Math.random()*.5,d.userData.originalY=d.position.y,d.userData.phase=Math.random()*Math.PI*2;const h=new THREE.Mesh(new THREE.BoxGeometry(n*1.1,n*.1,n*.15),new THREE.MeshBasicMaterial({color:e[i].ribbon}));h.position.y=n*.4,d.add(h);const g=new THREE.Mesh(new THREE.BoxGeometry(n*.15,n*.1,n*1.1),new THREE.MeshBasicMaterial({color:e[i].ribbon}));g.position.y=n*.4,d.add(g),a.add(d),ot.push(d)}}function Et(){m.add(U),Y=[];const a=new THREE.TextureLoader,e=s.photos.length,i=document.getElementById("debug-log");i&&(i.innerHTML+="<br>Loading photos...");for(let o=0;o<e;o++){const t=new THREE.Group,n=new THREE.PlaneGeometry(4,3),r=a.load(s.photos[o],D=>{console.log("Texture loaded:",s.photos[o]),D.image&&(t.userData.aspectRatio=D.image.width/D.image.height)},void 0,D=>{console.error("Error loading texture:",s.photos[o],D),i&&(i.innerHTML+=`<br>Err: ${s.photos[o]}`)});r.minFilter=THREE.LinearFilter;const c=new THREE.MeshBasicMaterial({map:r,side:THREE.FrontSide,transparent:!0,opacity:.9,color:16777215}),u=new THREE.Mesh(n,c);t.add(u);const p=new THREE.PlaneGeometry(4,3),d=new THREE.MeshBasicMaterial({map:r,side:THREE.FrontSide,transparent:!0,opacity:.9,color:16777215}),h=new THREE.Mesh(p,d);h.rotation.y=Math.PI,h.scale.x=-1,h.position.z=-.03,t.add(h);const g=new THREE.PlaneGeometry(4.2,3.2),E=new THREE.MeshBasicMaterial({color:l.colors.gold,side:THREE.DoubleSide}),y=new THREE.Mesh(g,E);y.position.z=-.01,t.add(y);const f=o/e,x=f*Math.PI*2.5,b=l.treeRadius+3+(1-f)*2,v=f*l.treeHeight*.7+3,k=Math.cos(x)*b,_=Math.sin(x)*b;t.position.set(k,v,_),t.lookAt(k*2,v,_*2),t.userData.photoIndex=o,Y.push(t),U.add(t)}}function ft(){const a=new THREE.BufferGeometry,e=[],i=[],o=[];for(let n=0;n<l.snowflakeCount;n++)e.push((Math.random()-.5)*120,Math.random()*80,(Math.random()-.5)*120),i.push(.3+Math.random()*.5),o.push((Math.random()-.5)*.02,.03+Math.random()*.05,Math.random()*Math.PI*2);a.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),a.setAttribute("size",new THREE.Float32BufferAttribute(i,1)),a.userData.velocities=o;const t=new THREE.PointsMaterial({color:16777215,size:.5,blending:THREE.AdditiveBlending,transparent:!0,opacity:.8,map:lt()});H=new THREE.Points(a,t),H.userData.velocities=o,m.add(H)}function wt(){M.aspect=window.innerWidth/window.innerHeight,M.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight)}function yt(){const a=document.getElementById("canvas-container");q=new THREE.Clock,U=new THREE.Group,m=new THREE.Scene,m.fog=new THREE.FogExp2(328976,.015),M=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),M.position.set(0,10,40),I=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),I.setSize(window.innerWidth,window.innerHeight),I.setPixelRatio(Math.min(window.devicePixelRatio,2)),a.appendChild(I.domElement);const e=new THREE.AmbientLight(4210784,.5);m.add(e);const i=new THREE.PointLight(l.colors.warmWhite,1.2,80);i.position.set(0,25,15),m.add(i),L=new THREE.PointLight(l.colors.gold,.8,50),L.position.set(15,10,0),m.add(L);const o=new THREE.PointLight(4482730,.4,40);o.position.set(0,-5,20),m.add(o),dt(),ut(),ht(),pt(),mt(),gt(),Et(),ft(),window.addEventListener("resize",wt,!1),bt()}function bt(){function a(){requestAnimationFrame(a),q.getDelta();const e=q.getElapsedTime();if(G+=(s.targetSnowSpeed-G)*.1,m.userData.treeGroup){const o=m.userData.treeGroup.rotation.y;m.userData.treeGroup.rotation.y+=(s.targetGroupRotation-o)*.05,s.handVisible||(s.targetGroupRotation+=.002),U.rotation.y=m.userData.treeGroup.rotation.y}if(L){const o=e*.3;L.position.x=Math.cos(o)*18,L.position.z=Math.sin(o)*18,L.position.y=10+Math.sin(e*.5)*3,L.intensity=.8}if(W){const o=W.geometry.attributes.size.array;for(let t=0;t<o.length;t++){const n=.25+t%10*.02;o[t]=n+Math.sin(e*2+t*.1)*.08}W.geometry.attributes.size.needsUpdate=!0}if(Z&&(Z.material.size=.5+Math.sin(e*4)*.2),A){A.rotation.y+=.005;const o=A.geometry.attributes.size.array,t=A.geometry.userData.initialSizes;for(let n=0;n<o.length;n++)o[n]=t[n]*(1+Math.sin(e*4+n)*.1);A.geometry.attributes.size.needsUpdate=!0}if(C){const o=C.geometry.attributes.position.array,t=C.geometry.attributes.phase.array,n=C.geometry.userData.originalPositions;for(let c=0;c<o.length/3;c++){const u=c*3+1,p=t[c];o[u]=n[u]+Math.sin(e*1.5+p)*.08}C.geometry.attributes.position.needsUpdate=!0;const r=C.geometry.attributes.size.array;for(let c=0;c<r.length;c++)r[c]=(1.5+Math.sin(e*2+c)*.3)*(1+Math.random()*.1);C.geometry.attributes.size.needsUpdate=!0}ot.forEach((o,t)=>{const n=o.userData.phase;o.position.y=o.userData.originalY+Math.sin(e*.8+n)*.05});let i;if(s.current===P.CLOSED?i=M.position.clone():s.current===P.IDLE?(s.targetCameraZ+=(35-s.targetCameraZ)*.02,s.targetCameraY+=(10-s.targetCameraY)*.02,i=new THREE.Vector3(0,s.targetCameraY,s.targetCameraZ)):i=new THREE.Vector3(0,s.targetCameraY,s.targetCameraZ),M.position.lerp(i,.06),M.lookAt(0,8,0),H){const o=H.geometry.attributes.position.array,t=H.userData.velocities;for(let n=0;n<o.length/3;n++){const r=n*3,c=n*3;o[r]+=Math.sin(e+t[c+2])*t[c],o[r+1]-=t[c+1]*G,o[r+1]<-10&&(o[r+1]=70,o[r]=(Math.random()-.5)*120,o[r+2]=(Math.random()-.5)*120)}H.geometry.attributes.position.needsUpdate=!0,H.material.size=.4+G*.1,H.material.opacity=.7+G*.08,H.rotation.y=-m.userData.treeGroup.rotation.y*.1}I.render(m,M)}a()}const X=document.getElementById("status-text"),J=document.getElementById("instruction-text"),K=document.getElementById("gesture-icon"),w=document.getElementById("overlay-image-container"),N=document.getElementById("debug-log"),it=document.getElementById("loading"),B=document.getElementById("hand-cursor"),Tt=document.getElementById("dot-hand"),xt=document.getElementById("dot-move"),Ht=document.getElementById("dot-closed"),et=document.getElementById("blessing-container"),V=document.getElementById("blessing-text"),z=document.getElementById("music-btn"),T=document.getElementById("music-hint"),Mt=document.getElementById("overlay-image");let $=0,R=null,j=!1;function O(a,e){return Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2))}function Rt(a){const e=Date.now();if(s.waveHistory.push({x:a,time:e}),s.waveHistory=s.waveHistory.filter(i=>e-i.time<500),s.waveHistory.length>=4){let i=0,o=0;for(let t=1;t<s.waveHistory.length;t++){const n=s.waveHistory[t].x-s.waveHistory[t-1].x,r=n>.01?1:n<-.01?-1:0;r!==0&&r!==o&&o!==0&&i++,r!==0&&(o=r)}if(i>=2&&e-s.lastWaveTime>2e3)return s.lastWaveTime=e,!0}return!1}function Ct(){V.textContent=tt[$],$=($+1)%tt.length,et.classList.add("active"),V.style.animation="none",V.offsetHeight,V.style.animation="blessingPulse 2s ease-in-out",setTimeout(()=>{et.classList.remove("active")},2e3)}function nt(){Tt.classList.toggle("active",s.handVisible),xt.classList.toggle("active",s.handVisible&&(Math.abs(s.swipeDeltaX)>.01||Math.abs(s.swipeDeltaY)>.01)),Ht.classList.toggle("active",s.isPinching)}function vt(a){if(!a){B.classList.remove("visible");return}const e=a[9],i=(1-e.x)*window.innerWidth,o=e.y*window.innerHeight;B.style.left=i-15+"px",B.style.top=o-15+"px",B.classList.add("visible"),B.classList.toggle("pinching",s.isPinching)}function Lt(){if(s.isPinching){if(!s.wasPinching){const a=new THREE.Raycaster,e=new THREE.Vector2;e.x=s.handX*2-1,e.y=-(s.handY*2)+1,a.setFromCamera(e,M);const i=a.intersectObjects(Y,!0);let o=-1;if(i.length>0){let n=i[0].object;for(;n&&n!==m&&n.userData.photoIndex===void 0;)n=n.parent;n&&n.userData.photoIndex!==void 0&&(o=n.userData.photoIndex,X.innerText=" ("+(o+1)+"/"+s.photos.length+")")}if(o!==-1)s.currentPhotoIndex=o;else{let n=1/0,r=0;const c=M.position,u=new THREE.Vector3;Y.forEach(p=>{p.getWorldPosition(u);const d=u.distanceTo(c);d<n&&(n=d,r=p.userData.photoIndex)}),s.currentPhotoIndex=r,X.innerText=" ("+(s.currentPhotoIndex+1)+"/"+s.photos.length+")"}const t=Y.find(n=>n.userData.photoIndex===s.currentPhotoIndex);if(t&&t.userData.aspectRatio){const n=t.userData.aspectRatio;w.style.aspectRatio=n,n>=1?(w.style.width="80%",w.style.height="auto",w.style.maxWidth="600px"):(w.style.width="auto",w.style.height="70%",w.style.maxWidth="none")}else w.style.aspectRatio="16/9",w.style.width="80%",w.style.height="auto";Mt.src=s.photos[s.currentPhotoIndex]}s.current=P.CLOSED,J.innerText="",K.innerText="",w.classList.add("active"),s.targetSnowSpeed=.3}else s.handVisible&&(s.current=P.INTERACTIVE,X.innerText="",J.innerText="",K.innerText="",w.classList.remove("active"),s.targetSnowSpeed=1);s.wasPinching=s.isPinching,s.current===P.INTERACTIVE&&(Math.abs(s.swipeDeltaX)>.008&&(s.targetGroupRotation+=s.swipeDeltaX*2.5),Math.abs(s.swipeDeltaY)>.008&&(s.targetCameraZ+=s.swipeDeltaY*15,s.targetCameraZ=Math.max(15,Math.min(50,s.targetCameraZ)),s.targetCameraY-=s.swipeDeltaY*5,s.targetCameraY=Math.max(5,Math.min(15,s.targetCameraY))))}function Pt(a){if(it.style.display="none",a.multiHandLandmarks&&a.multiHandLandmarks.length>0){s.handVisible=!0;const e=a.multiHandLandmarks[0];vt(e);const i=e[0],o=e[4],t=e[8],n=e[12],r=e[16],c=e[20],u=O(o,t);s.isPinching=u<.06;const p=(O(t,i)+O(n,i)+O(r,i)+O(c,i))/4;s.isHandOpen=p>.2&&!s.isPinching;const d=e[9],h=1-d.x,g=d.y;s.swipeDeltaX=(h-s.prevHandX)*5,s.swipeDeltaY=(g-s.prevHandY)*5,s.isHandOpen&&Rt(h)&&(s.isWaving=!0,Ct()),s.prevHandX=h,s.prevHandY=g,s.handX=h,s.handY=g,Lt(),nt(),N&&(N.innerText=`${s.isPinching,""} | ${s.isHandOpen,""}`)}else s.handVisible=!1,s.swipeDeltaX=0,s.swipeDeltaY=0,B.classList.remove("visible"),nt(),s.current!==P.IDLE&&(s.current=P.IDLE,X.innerText="",J.innerText="",K.innerText="",w.classList.remove("active"),s.targetSnowSpeed=1),N&&(N.innerText="")}async function Dt(){const a=document.getElementById("input-video"),e=new Hands({locateFile:o=>`${s.mpAssetBase}${o}`});e.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),e.onResults(Pt);const i=new Camera(a,{onFrame:async()=>{await e.send({image:a})},width:640,height:480});try{await i.start(),console.log("Camera started")}catch(o){throw console.error(o),it.innerHTML="ÊëÑÂÉèÂ§¥ÂêØÂä®Â§±Ë¥•<br>ËØ∑Ê£ÄÊü•ÊùÉÈôêÊàñ‰ΩøÁî® HTTPS",o}}function At(){function a(){R||(R=new Audio("Christmas.mp3"),R.volume=.5,R.loop=!0,R.addEventListener("error",n=>{console.error("Èü≥‰πêÂä†ËΩΩÂ§±Ë¥•:",n),T.textContent="Èü≥‰πêÂä†ËΩΩÂ§±Ë¥•",T.classList.add("show")}),R.addEventListener("canplay",()=>{j&&(T.textContent="Ê≠£Âú®Êí≠Êîæ: Christmas Eve",T.classList.add("show"),setTimeout(()=>T.classList.remove("show"),3e3))}))}function e(){j||(a(),R.play().then(()=>{j=!0,z.textContent="üîä",z.classList.add("playing"),T.textContent="Ê≠£Âú®Êí≠Êîæ",T.classList.add("show"),setTimeout(()=>T.classList.remove("show"),3e3)}).catch(n=>{console.log("ÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÊâçËÉΩÊí≠Êîæ:",n),T.textContent="ÁÇπÂáªÊåâÈíÆÊí≠ÊîæÈü≥‰πê",T.classList.add("show")}))}function i(){R&&(R.pause(),j=!1,z.textContent="üîá",z.classList.remove("playing"),T.textContent="ÁÇπÂáªÊí≠ÊîæÂú£ËØûÈü≥‰πê")}z.addEventListener("click",()=>{j?i():e()});let o=!1;function t(){o||(o=!0,e(),document.removeEventListener("click",t),document.removeEventListener("touchstart",t))}document.addEventListener("click",t),document.addEventListener("touchstart",t)}async function Bt(){try{await rt(),await ct(),yt(),await Dt(),At()}catch(a){console.error("Application failed to start:",a)}}Bt();
